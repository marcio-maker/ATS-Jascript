<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candidato ATS - Sistema Completo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.9/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.263.0/dist/umd/lucide.min.js"></script>
    <style>
        [data-lucide] {
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // HEADER COMPONENT
        const Header = () => (
            <header className="bg-indigo-600 text-white shadow-sm">
                <div className="max-w-7xl mx-auto px-4 py-4">
                    <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                        <h1 className="text-2xl font-bold">Minha Empresa</h1>
                        <nav className="flex flex-col sm:flex-row gap-2 sm:gap-4">
                            <a href="index.html" className="text-white hover:underline">Home</a>
                            <a href="index_about.html" className="text-white hover:underline">Sobre</a>
                            <a href="index_dashboard.html" className="text-white hover:underline">Dashboard</a>
                        </nav>
                    </div>
                </div>
            </header>
        );

        // ICONS
        const lucide = window.lucide;
        const Icon = ({ name, className = '', ...props }) => {
            useEffect(() => {
                lucide.createIcons();
            }, [name]);
            return React.createElement('i', {
                'data-lucide': name,
                className: `w-5 h-5 ${className}`,
                ...props
            });
        };

        // UTILITY COMPONENTS
        const StatCard = ({ title, value, icon, color }) => (
            <div className={`bg-white rounded-lg shadow-sm p-5 flex items-center gap-4 border-l-4 border-${color}-500 fade-in`}>
                <div className={`flex-shrink-0 bg-${color}-100 p-3 rounded-full text-${color}-600`}>
                    <Icon name={icon} className="w-6 h-6" />
                </div>
                <div>
                    <p className="text-sm font-medium text-gray-500">{title}</p>
                    <p className="text-2xl font-bold text-gray-900">{value}</p>
                </div>
            </div>
        );

        const CandidateCard = ({ candidate, onEdit, onToggleFavorite, onDelete }) => {
            const getStatusClasses = (status) => {
                switch (status) {
                    case 'approved': return 'bg-green-100 text-green-800';
                    case 'rejected': return 'bg-red-100 text-red-800';
                    default: return 'bg-yellow-100 text-yellow-800';
                }
            };
            const appliedDate = new Date(candidate.appliedDate).toLocaleDateString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });

            return (
                <div className="bg-white rounded-lg shadow-sm p-6 border border-gray-200 hover:shadow-md transition-shadow fade-in">
                    <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-2">
                        <div>
                            <h3 className="text-xl font-semibold text-gray-900">{candidate.name || 'N/A'}</h3>
                            <p className="text-sm text-gray-500">{candidate.position || 'N/A'}</p>
                        </div>
                        <div className="flex gap-2 mt-2 sm:mt-0">
                            <button
                                onClick={() => onToggleFavorite(candidate.id)}
                                className={`p-1 rounded-full hover:bg-gray-100 transition-colors ${candidate.isFavorite ? 'text-yellow-400' : 'text-gray-400'}`}
                                aria-label={candidate.isFavorite ? 'Remover dos favoritos' : 'Adicionar aos favoritos'}
                            >
                                <Icon name="star" className={candidate.isFavorite ? 'fill-current' : ''} />
                            </button>
                        </div>
                    </div>
                    
                    <div className="flex flex-col sm:flex-row sm:items-center justify-between text-sm text-gray-600 mb-4 gap-2">
                        <div className="flex items-center gap-1">
                            <Icon name="mail" className="w-4 h-4 text-gray-400" />
                            <span>{candidate.email || 'N/A'}</span>
                        </div>
                        <div className="flex items-center gap-1">
                            <Icon name="calendar" className="w-4 h-4 text-gray-400" />
                            <span>Data de aplicação: {appliedDate}</span>
                        </div>
                    </div>

                    <div className="flex flex-wrap gap-2 mb-4">
                        <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusClasses(candidate.status)}`}>
                            {candidate.status ? candidate.status.charAt(0).toUpperCase() + candidate.status.slice(1) : 'Pendente'}
                        </span>
                        {candidate.skills?.map(skill => (
                            <span key={skill} className="px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
                                {skill}
                            </span>
                        ))}
                    </div>

                    <div className="flex gap-3 flex-wrap justify-end">
                        <button
                            onClick={() => onEdit(candidate)}
                            className="text-indigo-600 hover:text-indigo-800"
                            aria-label="Editar candidato"
                        >
                            <Icon name="edit" />
                        </button>
                        <button
                            onClick={() => onDelete(candidate.id)}
                            className="text-red-600 hover:text-red-800"
                            aria-label="Excluir candidato"
                        >
                            <Icon name="trash" />
                        </button>
                    </div>
                </div>
            );
        };

        // MAIN COMPONENT
        const ATSApp = () => {
            const [candidates, setCandidates] = useState([]);
            const [filters, setFilters] = useState({
                search: '',
                status: '',
                position: '',
                favorites: false
            });
            const [showForm, setShowForm] = useState(false);
            const [editCandidateId, setEditCandidateId] = useState(null);
            const [formData, setFormData] = useState({
                name: '',
                email: '',
                phone: '',
                position: '',
                skills: [],
                status: 'pending',
                resume: null
            });
            const [newSkill, setNewSkill] = useState('');

            const positions = [
                'Desenvolvedor Frontend',
                'Desenvolvedor Backend',
                'Desenvolvedor Full Stack',
                'Designer UX/UI',
                'Analista de Dados',
                'Engenheiro DevOps',
                'Gerente de Produto'
            ];

            useEffect(() => {
                try {
                    const saved = localStorage.getItem('ats-candidates');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        if (Array.isArray(parsed)) {
                            setCandidates(parsed);
                        }
                    }
                } catch (error) {
                    console.error('Erro ao carregar candidatos do localStorage:', error);
                }
            }, []);

            useEffect(() => {
                try {
                    localStorage.setItem('ats-candidates', JSON.stringify(candidates));
                } catch (error) {
                    console.error('Erro ao salvar candidatos no localStorage:', error);
                }
            }, [candidates]);

            const resetForm = useCallback(() => {
                setFormData({
                    name: '',
                    email: '',
                    phone: '',
                    position: '',
                    skills: [],
                    status: 'pending',
                    resume: null
                });
                setNewSkill('');
                setEditCandidateId(null);
                setShowForm(false);
            }, []);

            const handleSaveCandidate = useCallback(() => {
                if (!formData.name.trim() || !formData.position) {
                    alert('Nome e posição são obrigatórios!');
                    return;
                }

                if (formData.email && !/^\S+@\S+\.\S+$/.test(formData.email)) {
                    alert('Formato de e-mail inválido!');
                    return;
                }

                if (formData.phone && !/^\+?\d{10,15}$/.test(formData.phone)) {
                    alert('Formato de telefone inválido! Use +1234567890 ou similar.');
                    return;
                }

                if (formData.resume && formData.resume.size > 5 * 1024 * 1024) {
                    alert('Arquivo de currículo muito grande! Máximo 5MB.');
                    return;
                }

                const resumeData = formData.resume ? {
                    name: formData.resume.name,
                    size: (formData.resume.size / 1024).toFixed(1) + ' KB',
                    type: formData.resume.type
                } : null;

                if (editCandidateId) {
                    setCandidates(prev => prev.map(c => 
                        c.id === editCandidateId ? {
                            ...c,
                            ...formData,
                            resume: resumeData
                        } : c
                    ));
                } else {
                    const newCandidate = {
                        id: Date.now(),
                        ...formData,
                        appliedDate: new Date().toISOString(),
                        isFavorite: false,
                        resume: resumeData
                    };
                    setCandidates(prev => [...prev, newCandidate]);
                }

                resetForm();
            }, [formData, editCandidateId, resetForm]);

            const updateCandidate = useCallback((id, updates) => {
                setCandidates(prev => 
                    prev.map(c => c.id === id ? { ...c, ...updates } : c)
                );
            }, []);

            const deleteCandidate = useCallback((id) => {
                if (window.confirm('Excluir este candidato?')) {
                    setCandidates(prev => prev.filter(c => c.id !== id));
                }
            }, []);

            const handleEditCandidate = useCallback((candidate) => {
                setEditCandidateId(candidate.id);
                setFormData({
                    name: candidate.name || '',
                    email: candidate.email || '',
                    phone: candidate.phone || '',
                    position: candidate.position || '',
                    skills: candidate.skills || [],
                    status: candidate.status || 'pending',
                    resume: candidate.resume || null
                });
                setShowForm(true);
            }, []);

            const toggleFavorite = useCallback((id) => {
                setCandidates(prev => 
                    prev.map(c => 
                        c.id === id ? { ...c, isFavorite: !c.isFavorite } : c
                    )
                );
            }, []);

            const addSkill = useCallback(() => {
                const trimmedSkill = newSkill.trim();
                if (trimmedSkill && !formData.skills.includes(trimmedSkill)) {
                    setFormData(prev => ({
                        ...prev,
                        skills: [...prev.skills, trimmedSkill]
                    }));
                    setNewSkill('');
                }
            }, [newSkill, formData.skills]);

            const handleKeyDown = useCallback((e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addSkill();
                }
            }, [addSkill]);

            const removeSkill = useCallback((skill) => {
                setFormData(prev => ({
                    ...prev,
                    skills: prev.skills.filter(s => s !== skill)
                }));
            }, []);

            const filteredCandidates = candidates.filter(candidate => {
                const matchesSearch = filters.search === '' || 
                    (candidate.name?.toLowerCase().includes(filters.search.toLowerCase()) || 
                     candidate.email?.toLowerCase().includes(filters.search.toLowerCase()));
                
                const matchesStatus = filters.status === '' || 
                    candidate.status === filters.status;
                
                const matchesPosition = filters.position === '' || 
                    candidate.position === filters.position;
                
                const matchesFavorites = !filters.favorites || 
                    candidate.isFavorite;
                
                return matchesSearch && matchesStatus && matchesPosition && matchesFavorites;
            });

            const stats = {
                total: candidates.length,
                pending: candidates.filter(c => c.status === 'pending').length,
                approved: candidates.filter(c => c.status === 'approved').length,
                rejected: candidates.filter(c => c.status === 'rejected').length,
                favorites: candidates.filter(c => c.isFavorite).length
            };

            const exportData = useCallback(() => {
                try {
                    const data = {
                        candidates,
                        exportedAt: new Date().toISOString(),
                        version: 'ATS 1.5'
                    };
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `ats-backup-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                } catch (error) {
                    console.error('Erro ao exportar dados:', error);
                    alert('Falha ao exportar dados');
                }
            }, [candidates]);

            const importData = useCallback((e) => {
                const file = e.target.files[0];
                if (!file) return;
                if (!file.name.endsWith('.json')) {
                    alert('Por favor, selecione um arquivo JSON.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.candidates && Array.isArray(data.candidates)) {
                            const validCandidates = data.candidates.filter(c => 
                                c.name?.trim() && c.position && c.id && c.appliedDate
                            );
                            setCandidates(validCandidates);
                            alert(`Importado ${validCandidates.length} candidatos válidos`);
                        } else {
                            alert('Formato de dados inválido');
                        }
                    } catch (error) {
                        alert('Erro ao processar o arquivo');
                        console.error('Erro ao importar dados:', error);
                    }
                };
                reader.readAsText(file);
            }, []);

            return (
                <div className="min-h-screen">
                    <Header />
                    <header className="bg-white shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 py-6">
                            <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                                <div className="flex items-center gap-3">
                                    <Icon name="users" className="w-8 h-8 text-indigo-600" />
                                    <div>
                                        <h1 className="text-2xl font-bold text-gray-900">Candidato ATS 1.5</h1>
                                        <p className="text-gray-600">Sistema de Gerenciamento de Candidatos</p>
                                    </div>
                                </div>
                                <div className="flex flex-wrap gap-3">
                                    <button
                                        onClick={() => { setEditCandidateId(null); setShowForm(true); }}
                                        className="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md flex items-center gap-2"
                                        aria-label="Adicionar novo candidato"
                                    >
                                        <Icon name="user-plus" />
                                        Adicionar Candidato
                                    </button>
                                    <label className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md flex items-center gap-2 cursor-pointer">
                                        <Icon name="upload" />
                                        Importar
                                        <input type="file" accept=".json" onChange={importData} className="hidden" />
                                    </label>
                                    <button
                                        onClick={exportData}
                                        className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md flex items-center gap-2"
                                        aria-label="Exportar dados"
                                    >
                                        <Icon name="download" />
                                        Exportar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto px-4 py-8">
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
                            <StatCard 
                                title="Total de Candidatos" 
                                value={stats.total} 
                                icon="users" 
                                color="indigo"
                            />
                            <StatCard 
                                title="Pendente" 
                                value={stats.pending} 
                                icon="clock" 
                                color="yellow"
                            />
                            <StatCard 
                                title="Aprovado" 
                                value={stats.approved} 
                                icon="check-circle" 
                                color="green"
                            />
                            <StatCard 
                                title="Rejeitado" 
                                value={stats.rejected} 
                                icon="x-circle" 
                                color="red"
                            />
                            <StatCard 
                                title="Favoritos" 
                                value={stats.favorites} 
                                icon="star" 
                                color="purple"
                            />
                        </div>

                        {showForm && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-lg shadow-xl w-full max-w-2xl fade-in max-h-[90vh] overflow-y-auto">
                                    <div className="px-6 py-4 border-b flex justify-between items-center">
                                        <h3 className="text-lg font-semibold">{editCandidateId ? 'Editar Candidato' : 'Adicionar Novo Candidato'}</h3>
                                        <button onClick={resetForm} aria-label="Fechar formulário">
                                            <Icon name="x" />
                                        </button>
                                    </div>
                                    <div className="p-6 space-y-4">
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700">Nome *</label>
                                                <input
                                                    type="text"
                                                    className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                                    value={formData.name}
                                                    onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700">E-mail</label>
                                                <input
                                                    type="email"
                                                    className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                                    value={formData.email}
                                                    onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700">Telefone</label>
                                                <input
                                                    type="text"
                                                    className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                                    value={formData.phone}
                                                    onChange={(e) => setFormData(prev => ({ ...prev, phone: e.target.value }))}
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700">Posição *</label>
                                                <select
                                                    className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                                    value={formData.position}
                                                    onChange={(e) => setFormData(prev => ({ ...prev, position: e.target.value }))}
                                                >
                                                    <option value="">Selecione a posição</option>
                                                    {positions.map(pos => <option key={pos} value={pos}>{pos}</option>)}
                                                </select>
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Skills</label>
                                            <div className="flex flex-wrap gap-2 mt-2">
                                                {formData.skills.map(skill => (
                                                    <span key={skill} className="flex items-center gap-1 px-2 py-0.5 rounded-full bg-indigo-100 text-indigo-800 text-xs">
                                                        {skill}
                                                        <button type="button" onClick={() => removeSkill(skill)}>
                                                            <Icon name="x" className="w-3 h-3" />
                                                        </button>
                                                    </span>
                                                ))}
                                            </div>
                                            <div className="flex mt-2 gap-2">
                                                <input
                                                    type="text"
                                                    className="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                                    placeholder="Adicionar skill"
                                                    value={newSkill}
                                                    onChange={(e) => setNewSkill(e.target.value)}
                                                    onKeyDown={handleKeyDown}
                                                />
                                                <button type="button" onClick={addSkill} className="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md">Adicionar</button>
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Status</label>
                                            <select
                                                className="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                                value={formData.status}
                                                onChange={(e) => setFormData(prev => ({ ...prev, status: e.target.value }))}
                                            >
                                                <option value="pending">Pendente</option>
                                                <option value="approved">Aprovado</option>
                                                <option value="rejected">Rejeitado</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Currículo</label>
                                            <input
                                                type="file"
                                                accept=".pdf,.doc,.docx"
                                                onChange={(e) => setFormData(prev => ({ ...prev, resume: e.target.files[0] }))}
                                            />
                                        </div>

                                        <div className="flex justify-end gap-3 mt-4">
                                            <button onClick={resetForm} className="px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300">Cancelar</button>
                                            <button onClick={handleSaveCandidate} className="px-4 py-2 rounded-md bg-indigo-600 hover:bg-indigo-700 text-white">{editCandidateId ? 'Salvar Alterações' : 'Adicionar'}</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            {filteredCandidates.map(candidate => (
                                <CandidateCard
                                    key={candidate.id}
                                    candidate={candidate}
                                    onEdit={handleEditCandidate}
                                    onToggleFavorite={toggleFavorite}
                                    onDelete={deleteCandidate}
                                />
                            ))}
                        </div>
                    </main>
                </div>
            );
        };

        ReactDOM.render(<ATSApp />, document.getElementById('root'));
    </script>
</body>
</html>
